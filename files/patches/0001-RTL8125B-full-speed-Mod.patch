From 6671d6695c6326631e00fe77105b3d3331faa3fd Mon Sep 17 00:00:00 2001
From: Gzxhwq <gzxhwq@gmail.com>
Date: Sun, 13 Sep 2020 06:41:29 +0000
Subject: [PATCH] RTL8125B full-speed Mod.

---
 package/lean/r8125/Makefile      |  0
 package/lean/r8125/src/Makefile  |  6 +++---
 package/lean/r8125/src/r8125_n.c | 14 +++++++++++---
 3 files changed, 14 insertions(+), 6 deletions(-)
 mode change 100755 => 100644 package/lean/r8125/Makefile

diff --git a/package/lean/r8125/Makefile b/package/lean/r8125/Makefile
old mode 100755
new mode 100644
diff --git a/package/lean/r8125/src/Makefile b/package/lean/r8125/src/Makefile
index 02d58004a..fa7bdc043 100644
--- a/package/lean/r8125/src/Makefile
+++ b/package/lean/r8125/src/Makefile
@@ -34,10 +34,10 @@ ENABLE_REALWOW_SUPPORT = n
 ENABLE_DASH_SUPPORT = n
 ENABLE_DASH_PRINTER_SUPPORT = n
 CONFIG_DOWN_SPEED_100 = n
-CONFIG_ASPM = y
-ENABLE_S5WOL = y
+CONFIG_ASPM = n
+ENABLE_S5WOL = n
 ENABLE_S5_KEEP_CURR_MAC = n
-ENABLE_EEE = y
+ENABLE_EEE = n
 ENABLE_S0_MAGIC_PACKET = n
 ENABLE_TX_NO_CLOSE = y
 
diff --git a/package/lean/r8125/src/r8125_n.c b/package/lean/r8125/src/r8125_n.c
index 5dabc179b..15c3bce66 100644
--- a/package/lean/r8125/src/r8125_n.c
+++ b/package/lean/r8125/src/r8125_n.c
@@ -4628,6 +4628,9 @@ rtl_ethtool_set_eee(struct net_device *net, struct ethtool_eee *eee)
                 return -EBUSY;
         }
 
+	//Add by GanFan
+	eee->eee_enabled=0;
+
         tp->eee_enabled = eee->eee_enabled;
         tp->eee_adv_t = ethtool_adv_to_mmd_eee_adv_t(eee->advertised);
 
@@ -8715,10 +8718,12 @@ rtl8125_hw_phy_config(struct net_device *dev)
 
         rtl8125_mdio_write(tp, 0x1F, 0x0000);
 
+//Add by GanFan
         if (HW_HAS_WRITE_PHY_MCU_RAM_CODE(tp)) {
-                if (tp->eee_enabled == 1)
-                        rtl8125_enable_eee(tp);
-                else
+//                if (tp->eee_enabled == 1)
+//                        rtl8125_enable_eee(tp);
+//                else
+			tp->eee_enabled=0;
                         rtl8125_disable_eee(tp);
         }
 }
@@ -8962,6 +8967,9 @@ rtl8125_init_software_variable(struct net_device *dev)
         if (timer_count == 0 || tp->mcfg == CFG_METHOD_DEFAULT)
                 tp->use_timer_interrrupt = FALSE;
 
+//Add by GanFan
+	tp->use_timer_interrrupt = FALSE;
+
         switch (tp->mcfg) {
         default:
                 tp->SwPaddingShortPktLen = ETH_ZLEN;
-- 
2.20.1

